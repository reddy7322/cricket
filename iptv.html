<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StreamForce IPTV</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Exo+2:wght@300;400;500;600&display=swap');
:root{--bg:#080c14;--surface:#0d1420;--s2:#111827;--s3:#1a2234;--accent:#00d4ff;--gold:#ffd700;--live:#ef4444;--green:#22c55e;--text:#e2e8f0;--dim:#64748b;--muted:#334155;--border:#1e293b;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'Exo 2',sans-serif;height:100vh;overflow:hidden;}
.app{display:grid;grid-template-columns:68px 270px 1fr;height:100vh;}
.nav{background:#050810;border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:16px 0;gap:4px;}
.nav-logo{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;color:var(--accent);letter-spacing:2px;margin-bottom:20px;text-shadow:0 0 16px var(--accent);}
.ni{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--dim);font-size:18px;transition:all .2s;position:relative;border:1px solid transparent;}
.ni:hover{background:var(--s3);color:var(--text);}
.ni.on{background:rgba(0,212,255,.15);color:var(--accent);border-color:rgba(0,212,255,.3);}
.ni.on::before{content:'';position:absolute;left:0;width:3px;height:55%;background:var(--accent);border-radius:0 3px 3px 0;box-shadow:0 0 8px var(--accent);}
.nav-sp{flex:1;}
.sidebar{background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.sb-head{padding:14px;border-bottom:1px solid var(--border);}
.sb-title{font-family:'Rajdhani',sans-serif;font-size:17px;font-weight:700;display:flex;align-items:center;gap:8px;margin-bottom:10px;}
.ldot{background:var(--live);color:#fff;font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;letter-spacing:1px;animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.4}}
.srch{display:flex;align-items:center;gap:8px;background:var(--s3);border:1px solid var(--border);border-radius:9px;padding:7px 11px;}
.srch input{background:none;border:none;outline:none;color:var(--text);font-family:'Exo 2',sans-serif;font-size:13px;width:100%;}
.srch input::placeholder{color:var(--dim);}
.cats{display:flex;gap:5px;padding:10px 14px;overflow-x:auto;border-bottom:1px solid var(--border);scrollbar-width:none;}
.cats::-webkit-scrollbar{display:none;}
.cat{padding:4px 11px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;border:1px solid var(--border);color:var(--dim);transition:all .2s;}
.cat:hover,.cat.on{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,.08);}
.ch-list{overflow-y:auto;flex:1;scrollbar-width:thin;scrollbar-color:var(--s3) transparent;}
.ch-list::-webkit-scrollbar{width:3px;}
.ch-list::-webkit-scrollbar-thumb{background:var(--s3);}
.ch{display:flex;align-items:center;gap:10px;padding:9px 14px;cursor:pointer;border-bottom:1px solid rgba(30,41,59,.4);transition:all .15s;}
.ch:hover{background:var(--s2);}
.ch.on{background:linear-gradient(90deg,rgba(0,212,255,.08),transparent);border-left:2px solid var(--accent);}
.ch-logo{width:40px;height:40px;border-radius:8px;background:var(--s3);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;border:1px solid var(--border);}
.ch-info{flex:1;min-width:0;}
.ch-name{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ch-prog{font-size:11px;color:var(--dim);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-top:2px;}
.ch-meta{display:flex;flex-direction:column;align-items:flex-end;gap:4px;}
.q{font-size:9px;font-weight:700;padding:1px 5px;border-radius:3px;letter-spacing:.5px;}
.q4k{background:rgba(255,215,0,.2);color:var(--gold);border:1px solid rgba(255,215,0,.3);}
.qhd{background:rgba(0,212,255,.15);color:var(--accent);border:1px solid rgba(0,212,255,.3);}
.qsd{background:rgba(100,116,139,.2);color:var(--dim);border:1px solid var(--border);}
.fav{color:var(--muted);font-size:13px;cursor:pointer;transition:.2s;}
.fav.on{color:var(--gold);}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;height:180px;gap:10px;color:var(--dim);text-align:center;font-size:13px;padding:20px;}
.empty span{font-size:36px;opacity:.4;}
.add-btn{margin:10px 14px;padding:10px;background:rgba(0,212,255,.08);border:1px dashed rgba(0,212,255,.3);border-radius:10px;color:var(--accent);font-size:13px;font-weight:600;cursor:pointer;text-align:center;transition:all .2s;font-family:'Exo 2',sans-serif;}
.add-btn:hover{background:rgba(0,212,255,.15);}
.main{display:flex;flex-direction:column;overflow:hidden;}
.topbar{display:flex;align-items:center;padding:10px 20px;border-bottom:1px solid var(--border);gap:14px;background:var(--surface);}
.now-info{flex:1;}
.now-name{font-family:'Rajdhani',sans-serif;font-size:19px;font-weight:700;display:flex;align-items:center;gap:8px;}
.now-prog{font-size:11px;color:var(--dim);margin-top:2px;}
.tb-acts{display:flex;gap:6px;}
.tbb{width:34px;height:34px;border-radius:8px;background:var(--s3);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--dim);font-size:15px;transition:all .2s;}
.tbb:hover{border-color:var(--accent);color:var(--accent);}
.player-wrap{flex:1;position:relative;background:#000;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.pscreen{width:100%;height:100%;background:linear-gradient(135deg,#0a0f1a,#050810);display:flex;align-items:center;justify-content:center;}
.ch-display{text-align:center;}
.big{font-family:'Rajdhani',sans-serif;font-size:64px;font-weight:700;color:rgba(255,255,255,.06);letter-spacing:4px;}
.stream-info{color:rgba(255,255,255,.2);font-size:12px;margin-top:8px;letter-spacing:2px;}
.eq{display:flex;align-items:center;gap:4px;margin-top:20px;justify-content:center;}
.eqb{width:5px;height:24px;background:var(--accent);border-radius:3px;animation:eq 1s ease-in-out infinite alternate;box-shadow:0 0 8px var(--accent);}
.eqb:nth-child(2){animation-delay:.15s;height:36px;}.eqb:nth-child(3){animation-delay:.3s;height:16px;}.eqb:nth-child(4){animation-delay:.08s;height:30px;}.eqb:nth-child(5){animation-delay:.22s;height:20px;}
@keyframes eq{from{transform:scaleY(.3);opacity:.5}to{transform:scaleY(1);opacity:1}}
.osd{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;background:linear-gradient(transparent 40%,rgba(0,0,0,.85));opacity:0;transition:opacity .3s;z-index:10;}
.player-wrap:hover .osd{opacity:1;}
.osd-in{padding:18px 22px;}
.osd-top{display:flex;align-items:flex-end;justify-content:space-between;margin-bottom:10px;}
.osd-name{font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700;}
.osd-show{font-size:12px;color:rgba(255,255,255,.65);margin-top:3px;}
.osd-clk{font-family:'Rajdhani',sans-serif;font-size:32px;font-weight:600;}
.pbar{height:3px;background:rgba(255,255,255,.2);border-radius:2px;margin-bottom:10px;cursor:pointer;position:relative;}
.pfill{height:100%;background:linear-gradient(90deg,var(--accent),#00ffcc);border-radius:2px;width:34%;box-shadow:0 0 8px var(--accent);position:relative;}
.pfill::after{content:'';position:absolute;right:-5px;top:50%;transform:translateY(-50%);width:10px;height:10px;background:#fff;border-radius:50%;box-shadow:0 0 8px var(--accent);}
.ctrl{display:flex;align-items:center;gap:6px;}
.cbtn{width:38px;height:38px;border-radius:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:17px;color:rgba(255,255,255,.75);transition:all .15s;}
.cbtn:hover{background:rgba(255,255,255,.15);color:#fff;}
.cplay{width:50px;height:50px;background:var(--accent);border-radius:13px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px;color:#000;box-shadow:0 0 20px rgba(0,212,255,.4);transition:all .2s;}
.cplay:hover{transform:scale(1.06);}
.csp{flex:1;}
.vol{display:flex;align-items:center;gap:7px;font-size:15px;color:rgba(255,255,255,.65);}
.vsl{width:80px;height:3px;background:rgba(255,255,255,.2);border-radius:2px;cursor:pointer;}
.vf{width:75%;height:100%;background:var(--accent);border-radius:2px;}
.epg-bar{background:var(--surface);border-top:1px solid var(--border);height:148px;display:flex;flex-direction:column;overflow:hidden;}
.etabs{display:flex;gap:16px;padding:8px 20px 0;border-bottom:1px solid var(--border);}
.etab{padding:7px 0;font-size:11px;font-weight:600;letter-spacing:.8px;text-transform:uppercase;cursor:pointer;color:var(--dim);border-bottom:2px solid transparent;transition:all .2s;}
.etab.on{color:var(--accent);border-bottom-color:var(--accent);}
.epg-row{display:flex;padding:10px 20px;overflow-x:auto;scrollbar-width:none;align-items:center;flex:1;gap:0;}
.epg-row::-webkit-scrollbar{display:none;}
.ei{flex-shrink:0;background:var(--s2);border:1px solid var(--border);border-radius:9px;padding:9px 13px;margin-right:9px;cursor:pointer;transition:all .2s;min-width:150px;}
.ei:hover{border-color:var(--accent);}
.ei.now{border-color:rgba(0,212,255,.4);background:rgba(0,212,255,.05);}
.ei.past{opacity:.5;}
.et{font-size:10px;color:var(--accent);font-weight:600;letter-spacing:.5px;margin-bottom:3px;}
.ei.past .et{color:var(--dim);}
.es{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ep{height:2px;background:var(--border);border-radius:1px;margin-top:5px;}
.epf{height:100%;background:var(--accent);border-radius:1px;}
/* overlays */
.overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.78);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(6px);}
.overlay.open{display:flex;}
/* settings */
.sp{background:var(--s2);border:1px solid var(--border);border-radius:16px;padding:22px;width:300px;box-shadow:0 20px 60px rgba(0,0,0,.6);}
.sp-title{font-family:'Rajdhani',sans-serif;font-size:20px;font-weight:700;color:var(--accent);margin-bottom:16px;letter-spacing:1px;}
.spi{display:flex;align-items:center;gap:12px;padding:10px;border-radius:9px;cursor:pointer;transition:background .2s;margin-bottom:4px;}
.spi:hover{background:var(--s3);}
.sp-icon{width:38px;height:38px;background:var(--s3);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;}
.sp-label{font-size:13px;font-weight:500;}
.sp-sub{font-size:11px;color:var(--dim);margin-top:1px;}
.sp-close{margin-top:14px;width:100%;padding:9px;background:var(--s3);border:1px solid var(--border);border-radius:9px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:13px;cursor:pointer;transition:all .2s;}
.sp-close:hover{border-color:var(--accent);color:var(--accent);}
/* â•â•â• PLAYLIST MODAL â•â•â• */
.pl-modal{background:var(--s2);border:1px solid var(--border);border-radius:20px;width:560px;max-width:96vw;max-height:92vh;overflow-y:auto;box-shadow:0 30px 80px rgba(0,0,0,.8);animation:mIn .3s cubic-bezier(.175,.885,.32,1.275);scrollbar-width:thin;scrollbar-color:var(--s3) transparent;}
@keyframes mIn{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
.pl-head{display:flex;align-items:center;justify-content:space-between;padding:22px 24px 0;position:sticky;top:0;background:var(--s2);z-index:5;padding-bottom:0;}
.pl-title{font-family:'Rajdhani',sans-serif;font-size:22px;font-weight:700;color:var(--accent);letter-spacing:1px;}
.pl-x{width:30px;height:30px;border-radius:7px;background:var(--s3);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--dim);font-size:13px;transition:all .2s;}
.pl-x:hover{background:rgba(239,68,68,.2);color:#ef4444;}
/* method cards */
.method-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:18px 24px;}
.mc{border:2px solid var(--border);border-radius:14px;padding:16px;cursor:pointer;transition:all .2s;text-align:center;background:var(--s3);}
.mc:hover{border-color:rgba(0,212,255,.4);background:rgba(0,212,255,.04);}
.mc.sel{border-color:var(--accent);background:rgba(0,212,255,.08);box-shadow:0 0 20px rgba(0,212,255,.12);}
.mc-icon{font-size:30px;margin-bottom:8px;}
.mc-name{font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;letter-spacing:.5px;}
.mc-desc{font-size:11px;color:var(--dim);margin-top:3px;line-height:1.4;}
/* form */
.pl-form{padding:0 24px 22px;display:flex;flex-direction:column;gap:13px;}
.form-block{display:flex;flex-direction:column;gap:13px;}
.form-sec{font-family:'Rajdhani',sans-serif;font-size:16px;font-weight:700;padding:14px 0 0;border-top:1px solid var(--border);display:flex;align-items:center;gap:8px;}
.field{display:flex;flex-direction:column;gap:5px;}
.lbl{font-size:11px;font-weight:600;color:var(--dim);text-transform:uppercase;letter-spacing:.8px;}
.inp{background:var(--s3);border:1px solid var(--border);border-radius:10px;padding:10px 13px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:13px;outline:none;transition:border-color .2s;width:100%;}
.inp:focus{border-color:var(--accent);}
.inp::placeholder{color:var(--muted);}
.inp.err{border-color:#ef4444!important;animation:shake .3s;}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.inp-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.hint{font-size:11px;color:var(--dim);line-height:1.5;}
.hint.info{background:rgba(0,212,255,.06);border:1px solid rgba(0,212,255,.2);border-radius:8px;padding:10px;color:var(--text);font-size:12px;}
.hint.warn{background:rgba(255,107,53,.06);border:1px solid rgba(255,107,53,.2);border-radius:8px;padding:10px;color:var(--text);font-size:12px;}
/* sub-tabs for m3u */
.sub-tabs{display:flex;gap:8px;}
.stab{flex:1;padding:8px;background:transparent;border:1px solid var(--border);border-radius:9px;color:var(--dim);font-family:'Exo 2',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;text-align:center;}
.stab.on{border-color:var(--accent);color:var(--accent);background:rgba(0,212,255,.06);}
/* dropzone */
.dz{border:2px dashed var(--border);border-radius:12px;padding:26px 20px;text-align:center;cursor:pointer;transition:all .2s;background:var(--s3);display:flex;flex-direction:column;align-items:center;gap:7px;}
.dz.over{border-color:var(--accent);background:rgba(0,212,255,.05);}
.dz-ico{font-size:32px;}
.dz-txt{font-size:13px;font-weight:600;}
.dz-sub{font-size:11px;color:var(--dim);}
.file-chip{display:flex;align-items:center;justify-content:space-between;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.3);border-radius:9px;padding:9px 13px;font-size:13px;color:var(--accent);}
.chip-rm{cursor:pointer;color:var(--dim);transition:.2s;}
.chip-rm:hover{color:#ef4444;}
/* status */
.status{border-radius:9px;padding:10px 13px;font-size:13px;font-weight:500;display:none;}
.status.ok{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:var(--green);display:block;}
.status.err{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);color:#ef4444;display:block;}
.status.load{background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.2);color:var(--accent);display:block;}
/* buttons */
.btn-p{padding:12px;background:linear-gradient(135deg,var(--accent),#00a8cc);border:none;border-radius:10px;color:#000;font-family:'Exo 2',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:all .2s;letter-spacing:.5px;box-shadow:0 4px 16px rgba(0,212,255,.25);width:100%;}
.btn-p:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,212,255,.4);}
.btn-p:active{transform:translateY(0);}
.btn-o{padding:10px 16px;background:transparent;border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'Exo 2',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;width:100%;text-align:center;}
.btn-o:hover{border-color:var(--accent);color:var(--accent);}
/* saved */
.saved-sec{padding:0 24px 24px;}
.saved-title{font-size:11px;font-weight:600;color:var(--dim);text-transform:uppercase;letter-spacing:.8px;padding:14px 0 10px;border-top:1px solid var(--border);}
.saved-list{display:flex;flex-direction:column;gap:8px;}
.si{display:flex;align-items:center;gap:11px;padding:10px 13px;background:var(--s3);border:1px solid var(--border);border-radius:10px;}
.si-ico{font-size:20px;}
.si-info{flex:1;min-width:0;}
.si-name{font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.si-meta{font-size:11px;color:var(--dim);margin-top:2px;}
.si-badge{font-size:9px;font-weight:700;padding:2px 6px;border-radius:4px;background:rgba(0,212,255,.12);color:var(--accent);border:1px solid rgba(0,212,255,.3);letter-spacing:.5px;white-space:nowrap;}
.si-acts{display:flex;gap:5px;}
.sia{padding:4px 9px;border-radius:6px;font-size:11px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--dim);font-family:'Exo 2',sans-serif;transition:all .2s;}
.sia:hover{border-color:var(--accent);color:var(--accent);}
.sia.del:hover{border-color:#ef4444;color:#ef4444;}
/* toast */
.toast{position:fixed;bottom:22px;right:22px;background:var(--s2);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:10px;padding:11px 15px;font-size:13px;z-index:999;transform:translateX(130%);transition:transform .3s cubic-bezier(.175,.885,.32,1.275);box-shadow:0 8px 24px rgba(0,0,0,.5);max-width:270px;}
.toast.show{transform:translateX(0);}
.t-title{font-weight:600;color:var(--accent);margin-bottom:2px;}
.toast.tok{border-left-color:var(--green);}.toast.tok .t-title{color:var(--green);}
.toast.terr{border-left-color:#ef4444;}.toast.terr .t-title{color:#ef4444;}
@media(max-width:860px){.app{grid-template-columns:56px 1fr;}.sidebar{display:none;}}
</style>
</head>
<body>
<div class="app">
  <nav class="nav">
    <div class="nav-logo">SF</div>
    <div class="ni on" title="Live TV">ğŸ“º</div>
    <div class="ni" title="Movies" onclick="toast('Movies','VOD coming soon')">ğŸ¬</div>
    <div class="ni" title="Series" onclick="toast('Series','Series coming soon')">ğŸ­</div>
    <div class="ni" title="Favourites" onclick="toast('Favourites','Starred channels')">â­</div>
    <div class="ni" title="EPG" onclick="toast('EPG','Program guide')">ğŸ“…</div>
    <div class="ni" title="DVR" onclick="toast('DVR','Recordings')">âºï¸</div>
    <div class="nav-sp"></div>
    <div class="ni" title="Settings" onclick="openSettings()">âš™ï¸</div>
  </nav>

  <aside class="sidebar">
    <div class="sb-head">
      <div class="sb-title">Channels <span class="ldot">LIVE</span></div>
      <div class="srch"><span>ğŸ”</span><input type="text" placeholder="Search channels..." oninput="filterCh(this.value)"/></div>
    </div>
    <div class="cats">
      <div class="cat on" onclick="setCat(this,'all')">All</div>
      <div class="cat" onclick="setCat(this,'sports')">Sports</div>
      <div class="cat" onclick="setCat(this,'news')">News</div>
      <div class="cat" onclick="setCat(this,'movies')">Movies</div>
      <div class="cat" onclick="setCat(this,'kids')">Kids</div>
      <div class="cat" onclick="setCat(this,'docs')">Docs</div>
    </div>
    <div class="ch-list" id="chList"></div>
    <button class="add-btn" onclick="openPlaylist()">ï¼‹ Add Playlist</button>
  </aside>

  <main class="main">
    <div class="topbar">
      <div class="now-info">
        <div class="now-name" id="nowName">ESPN HD <span class="ldot">LIVE</span></div>
        <div class="now-prog" id="nowProg">Monday Night Football: Chiefs vs Ravens</div>
      </div>
      <div class="tb-acts">
        <div class="tbb" onclick="toast('ğŸ“¡ Cast','Casting to device...')">ğŸ“¡</div>
        <div class="tbb" onclick="toast('PiP','Picture-in-Picture')">â§‰</div>
        <div class="tbb" onclick="toast('ğŸ”´ REC','Recording started!')">âº</div>
        <div class="tbb" onclick="toast('Fullscreen','Press F11')">â›¶</div>
      </div>
    </div>
    <div class="player-wrap">
      <div class="pscreen">
        <div class="ch-display">
          <div class="big" id="bigLogo">ESPN</div>
          <div class="stream-info">STREAM ACTIVE Â· 1080p Â· H.264</div>
          <div class="eq"><div class="eqb"></div><div class="eqb"></div><div class="eqb"></div><div class="eqb"></div><div class="eqb"></div></div>
        </div>
      </div>
      <div class="osd">
        <div class="osd-in">
          <div class="osd-top">
            <div><div class="osd-name" id="osdName">ESPN HD</div><div class="osd-show" id="osdShow">Monday Night Football Â· 8:00 â€“ 11:30 PM</div></div>
            <div class="osd-clk" id="osdClk">20:47</div>
          </div>
          <div class="pbar" onclick="scrub(event,this)"><div class="pfill" id="pfill"></div></div>
          <div class="ctrl">
            <div class="cbtn" onclick="toast('â® Prev','Previous channel')">â®</div>
            <div class="cbtn" onclick="toast('â†©','Live â€“ seek N/A')">â†©10</div>
            <div class="cplay" id="playBtn" onclick="togglePlay()">â¸</div>
            <div class="cbtn" onclick="toast('â†ª','Live â€“ seek N/A')">10â†ª</div>
            <div class="cbtn" onclick="toast('â­ Next','Next channel')">â­</div>
            <div class="csp"></div>
            <div class="vol">ğŸ”Š<div class="vsl" onclick="setVol(event,this)"><div class="vf" id="vf"></div></div></div>
            <div class="cbtn" onclick="toast('ğŸµ Audio','English 5.1')">ğŸµ</div>
            <div class="cbtn" onclick="toast('ğŸ’¬ Subs','Subtitles: Off')">ğŸ’¬</div>
            <div class="cbtn" onclick="toast('ğŸ“¶ Quality','Auto 1080p')">ğŸ“¶</div>
          </div>
        </div>
      </div>
    </div>
    <div class="epg-bar">
      <div class="etabs"><div class="etab on">ğŸ“… Schedule</div><div class="etab" style="margin-left:10px">â„¹ï¸ Info</div><div class="etab" style="margin-left:10px">ğŸŒ Related</div></div>
      <div class="epg-row" id="epgRow"></div>
    </div>
  </main>
</div>

<!-- SETTINGS -->
<div class="overlay" id="settingsOv" onclick="if(event.target===this)closeSettings()">
  <div class="sp">
    <div class="sp-title">âš™ï¸ Settings</div>
    <div class="spi" onclick="closeSettings();openPlaylist()">
      <div class="sp-icon">ğŸ“‹</div>
      <div><div class="sp-label">Add Playlist</div><div class="sp-sub">M3U Â· Xtream Â· Stalker Â· MAC Portal</div></div>
    </div>
    <div class="spi" onclick="toast('EPG','Configure EPG/XMLTV source')">
      <div class="sp-icon">ğŸ“¡</div><div><div class="sp-label">EPG Source</div><div class="sp-sub">Electronic Program Guide</div></div>
    </div>
    <div class="spi" onclick="toast('Player','ExoPlayer / VLC / Software')">
      <div class="sp-icon">â–¶ï¸</div><div><div class="sp-label">Player Engine</div><div class="sp-sub">ExoPlayer / VLC / Software</div></div>
    </div>
    <div class="spi" onclick="toast('Parental','PIN-protect channels')">
      <div class="sp-icon">ğŸ”’</div><div><div class="sp-label">Parental Controls</div><div class="sp-sub">PIN protection for channels</div></div>
    </div>
    <div class="spi" onclick="toast('Theme','Appearance settings')">
      <div class="sp-icon">ğŸ¨</div><div><div class="sp-label">Appearance</div><div class="sp-sub">Theme, font & layout</div></div>
    </div>
    <button class="sp-close" onclick="closeSettings()">Close</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ADD PLAYLIST MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="overlay" id="plOv" onclick="if(event.target===this)closePl()">
  <div class="pl-modal">
    <div class="pl-head">
      <div class="pl-title">ğŸ“‹ Add Playlist</div>
      <div class="pl-x" onclick="closePl()">âœ•</div>
    </div>

    <!-- METHOD PICKER -->
    <div class="method-grid">
      <div class="mc sel" id="mc-m3u" onclick="selM('m3u')">
        <div class="mc-icon">ğŸ”—</div>
        <div class="mc-name">M3U / M3U8</div>
        <div class="mc-desc">Paste URL or upload .m3u file</div>
      </div>
      <div class="mc" id="mc-xtream" onclick="selM('xtream')">
        <div class="mc-icon">âš¡</div>
        <div class="mc-name">Xtream Codes</div>
        <div class="mc-desc">Server URL + username & password</div>
      </div>
      <div class="mc" id="mc-stalker" onclick="selM('stalker')">
        <div class="mc-icon">ğŸ“¡</div>
        <div class="mc-name">Stalker Portal</div>
        <div class="mc-desc">Portal URL + MAC address</div>
      </div>
      <div class="mc" id="mc-mac" onclick="selM('mac')">
        <div class="mc-icon">ğŸ–¥ï¸</div>
        <div class="mc-name">MAC Portal</div>
        <div class="mc-desc">Device MAC authentication</div>
      </div>
    </div>

    <div class="pl-form">

      <!-- â•â• M3U FORM â•â• -->
      <div class="form-block" id="form-m3u">
        <div class="form-sec">ğŸ”— M3U Playlist</div>
        <div class="field">
          <label class="lbl">Playlist Name *</label>
          <input class="inp" id="m3u-name" placeholder="e.g. My IPTV Channels"/>
        </div>
        <div class="sub-tabs">
          <button class="stab on" id="st-url" onclick="m3uTab('url')">ğŸ”— M3U URL</button>
          <button class="stab" id="st-file" onclick="m3uTab('file')">ğŸ“ Upload File</button>
        </div>
        <div id="m3u-url-body" class="field">
          <label class="lbl">M3U URL *</label>
          <input class="inp" id="m3u-url" type="url" placeholder="http://provider.com/playlist.m3u"/>
          <span class="hint">Full M3U or M3U8 URL from your provider</span>
          <label class="lbl" style="margin-top:6px">Auto-refresh</label>
          <select class="inp" id="m3u-ref" style="cursor:pointer"><option value="never">Never</option><option value="24h" selected>Every 24h</option><option value="12h">Every 12h</option><option value="6h">Every 6h</option></select>
        </div>
        <div id="m3u-file-body" style="display:none">
          <div class="dz" id="dz" ondragover="event.preventDefault();this.classList.add('over')" ondragleave="this.classList.remove('over')" ondrop="fileDrop(event)">
            <div class="dz-ico">ğŸ“‚</div>
            <div class="dz-txt">Drag & drop M3U file here</div>
            <div class="dz-sub">or</div>
            <label class="btn-o" style="width:auto;padding:7px 16px;cursor:pointer">Browse File<input type="file" id="fileInp" accept=".m3u,.m3u8,.txt" style="display:none" onchange="filePick(event)"/></label>
            <div class="dz-sub">Supported: .m3u, .m3u8</div>
          </div>
          <div class="file-chip" id="fchip" style="display:none;margin-top:8px"><span id="chipName"></span><span class="chip-rm" onclick="clearFile()">âœ•</span></div>
        </div>
        <div class="status" id="m3u-st"></div>
        <button class="btn-p" onclick="addM3U()">â• Add Playlist</button>
      </div>

      <!-- â•â• XTREAM FORM â•â• -->
      <div class="form-block" id="form-xtream" style="display:none">
        <div class="form-sec">âš¡ Xtream Codes API</div>
        <div class="field">
          <label class="lbl">Playlist Name *</label>
          <input class="inp" id="xt-name" placeholder="My Xtream Provider"/>
        </div>
        <div class="field">
          <label class="lbl">Server URL *</label>
          <input class="inp" id="xt-host" type="url" placeholder="http://provider.com:8080"/>
          <span class="hint">Include port number if required</span>
        </div>
        <div class="inp-row">
          <div class="field"><label class="lbl">Username *</label><input class="inp" id="xt-user" placeholder="username"/></div>
          <div class="field"><label class="lbl">Password *</label><input class="inp" id="xt-pass" type="password" placeholder="password"/></div>
        </div>
        <div class="field">
          <label class="lbl">Stream Format</label>
          <select class="inp" style="cursor:pointer" id="xt-fmt"><option value="ts">MPEG-TS (.ts)</option><option value="m3u8">HLS (.m3u8)</option><option value="rtmp">RTMP</option></select>
        </div>
        <p class="hint">ğŸ”’ Credentials are stored on your device only â€” never sent to third parties.</p>
        <button class="btn-o" onclick="testXtream()">ğŸ” Test Connection</button>
        <div class="status" id="xt-st"></div>
        <button class="btn-p" onclick="addXtream()">â• Add Playlist</button>
      </div>

      <!-- â•â• STALKER FORM â•â• -->
      <div class="form-block" id="form-stalker" style="display:none">
        <div class="form-sec">ğŸ“¡ Stalker Portal</div>
        <p class="hint info">Stalker Portal is used by MAG boxes and Formuler devices. It authenticates via your device MAC address with a portal/middleware URL.</p>
        <div class="field">
          <label class="lbl">Playlist Name *</label>
          <input class="inp" id="st-name" placeholder="My Stalker Provider"/>
        </div>
        <div class="field">
          <label class="lbl">Portal URL *</label>
          <input class="inp" id="st-url2" type="url" placeholder="http://provider.com/stalker_portal/c/"/>
          <span class="hint">Usually ends with /stalker_portal/c/ or /c/</span>
        </div>
        <div class="field">
          <label class="lbl">MAC Address *</label>
          <input class="inp" id="st-mac" placeholder="00:1A:79:XX:XX:XX" maxlength="17" oninput="fmtMAC(this)"/>
          <span class="hint">Found on your MAG/Formuler device or box label. Format: 00:1A:79:XX:XX:XX</span>
        </div>
        <div class="inp-row">
          <div class="field"><label class="lbl">Serial Number</label><input class="inp" id="st-serial" placeholder="Optional"/></div>
          <div class="field"><label class="lbl">Device ID</label><input class="inp" id="st-devid" placeholder="Optional"/></div>
        </div>
        <button class="btn-o" onclick="testStalker()">ğŸ” Test Portal</button>
        <div class="status" id="st-st"></div>
        <button class="btn-p" onclick="addStalker()">â• Add Playlist</button>
      </div>

      <!-- â•â• MAC PORTAL FORM â•â• -->
      <div class="form-block" id="form-mac" style="display:none">
        <div class="form-sec">ğŸ–¥ï¸ MAC Portal</div>
        <p class="hint warn">MAC Portal authenticates using only your device MAC address â€” no username/password needed. Works with most middleware portals.</p>
        <div class="field">
          <label class="lbl">Playlist Name *</label>
          <input class="inp" id="mac-name" placeholder="My MAC Portal"/>
        </div>
        <div class="field">
          <label class="lbl">Portal URL *</label>
          <input class="inp" id="mac-url" type="url" placeholder="http://provider.com/portal/"/>
          <span class="hint">The portal/middleware URL from your IPTV provider</span>
        </div>
        <div class="field">
          <label class="lbl">MAC Address *</label>
          <input class="inp" id="mac-mac" placeholder="00:1A:79:XX:XX:XX" maxlength="17" oninput="fmtMAC(this)"/>
          <span class="hint">Find it on your device Info screen or box label</span>
        </div>
        <div class="field">
          <label class="lbl">Timezone</label>
          <select class="inp" style="cursor:pointer" id="mac-tz">
            <option value="auto">Auto-detect</option>
            <option value="Europe/London">Europe/London</option>
            <option value="America/New_York">America/New_York</option>
            <option value="America/Los_Angeles">America/Los_Angeles</option>
            <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
            <option value="Asia/Dubai">Asia/Dubai (GST)</option>
            <option value="Asia/Singapore">Asia/Singapore</option>
            <option value="Australia/Sydney">Australia/Sydney</option>
          </select>
        </div>
        <button class="btn-o" onclick="testMAC()">ğŸ” Test MAC Auth</button>
        <div class="status" id="mac-st"></div>
        <button class="btn-p" onclick="addMAC()">â• Add Playlist</button>
      </div>

    </div><!-- /pl-form -->

    <!-- SAVED PLAYLISTS -->
    <div class="saved-sec" id="savedSec" style="display:none">
      <div class="saved-title">Saved Playlists</div>
      <div class="saved-list" id="savedList"></div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"><div class="t-title" id="tTitle"></div><div id="tMsg"></div></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let channels=[
  {id:1,name:'ESPN HD',prog:'Monday Night Football',q:'HD',cat:'sports',ico:'ğŸˆ',clr:'#cc0000'},
  {id:2,name:'Sky Sports',prog:'Premier League Highlights',q:'4K',cat:'sports',ico:'âš½',clr:'#0070c0'},
  {id:3,name:'CNN International',prog:'World News Tonight',q:'HD',cat:'news',ico:'ğŸ“°',clr:'#cc0000'},
  {id:4,name:'BBC News',prog:"The 9 O'Clock News",q:'HD',cat:'news',ico:'ğŸ”µ',clr:'#bb1919'},
  {id:5,name:'HBO Max',prog:'House of the Dragon S2',q:'4K',cat:'movies',ico:'ğŸ‰',clr:'#6a0dad'},
  {id:6,name:'Netflix TV',prog:'Stranger Things S5',q:'4K',cat:'movies',ico:'ğŸ¬',clr:'#e50914'},
  {id:7,name:'Disney Channel',prog:'Bluey: New Episodes',q:'HD',cat:'kids',ico:'ğŸ¶',clr:'#0063e5'},
  {id:8,name:'Nickelodeon',prog:'SpongeBob SquarePants',q:'SD',cat:'kids',ico:'ğŸ§½',clr:'#f97316'},
  {id:9,name:'National Geographic',prog:'Secret Ocean',q:'4K',cat:'docs',ico:'ğŸŒŠ',clr:'#f59e0b'},
  {id:10,name:'Discovery HD',prog:'Engineering Connections',q:'HD',cat:'docs',ico:'ğŸ”¬',clr:'#22c55e'},
  {id:11,name:'TNT Sports',prog:'NBA Live: Lakers vs GSW',q:'HD',cat:'sports',ico:'ğŸ€',clr:'#d97706'},
  {id:12,name:'Fox News',prog:'The Ingraham Angle',q:'HD',cat:'news',ico:'ğŸ“¡',clr:'#1d4ed8'},
];
let curCh=channels[0],favs=new Set([1,5]),curCat='all',playing=true,progress=34,selFile=null;
let playlists=[];try{playlists=JSON.parse(localStorage.getItem('sf_pl')||'[]');}catch(e){}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHANNELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderChs(list){
  const el=document.getElementById('chList');
  if(!list.length){el.innerHTML='<div class="empty"><span>ğŸ“­</span>No channels found.<br>Add a playlist to get started.</div>';return;}
  el.innerHTML=list.map(c=>`
    <div class="ch ${c.id===curCh.id?'on':''}" onclick="pickCh(${c.id})">
      <div class="ch-logo" style="color:${c.clr}">${c.ico}</div>
      <div class="ch-info"><div class="ch-name">${c.name}</div><div class="ch-prog">${c.prog}</div></div>
      <div class="ch-meta">
        <span class="q ${c.q==='4K'?'q4k':c.q==='HD'?'qhd':'qsd'}">${c.q}</span>
        <span class="fav ${favs.has(c.id)?'on':''}" onclick="toggleFav(event,${c.id})">â˜…</span>
      </div>
    </div>`).join('');
}
function filterCh(q){renderChs(channels.filter(c=>(curCat==='all'||c.cat===curCat)&&c.name.toLowerCase().includes(q.toLowerCase())));}
function setCat(el,cat){document.querySelectorAll('.cat').forEach(c=>c.classList.remove('on'));el.classList.add('on');curCat=cat;filterCh(document.querySelector('.srch input').value);}
function pickCh(id){
  curCh=channels.find(c=>c.id===id);
  document.getElementById('nowName').innerHTML=curCh.name+' <span class="ldot">LIVE</span>';
  document.getElementById('nowProg').textContent=curCh.prog;
  document.getElementById('bigLogo').textContent=curCh.ico+' '+curCh.name.split(' ')[0];
  document.getElementById('osdName').textContent=curCh.name;
  document.getElementById('osdShow').textContent=curCh.prog+' Â· Now Live';
  renderChs(channels.filter(c=>curCat==='all'||c.cat===curCat));
  toast('ğŸ“º Tuning...',curCh.name);progress=0;
}
function toggleFav(e,id){e.stopPropagation();favs.has(id)?favs.delete(id):favs.add(id);renderChs(channels.filter(c=>curCat==='all'||c.cat===curCat));toast(favs.has(id)?'â­ Added':'Removed',channels.find(c=>c.id===id).name);}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EPG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const epg=[{t:'18:00',s:'Sports Center',past:true,p:100},{t:'19:30',s:'NFL Pre-Show',past:true,p:100},{t:'20:00',s:'Monday Night Football',now:true,p:34},{t:'23:30',s:'SportsCenter Late',p:0},{t:'00:00',s:'NBA Tonight',p:0},{t:'01:00',s:'Boxing: Main Event',p:0}];
function renderEPG(){document.getElementById('epgRow').innerHTML=epg.map(e=>`<div class="ei ${e.past?'past':''} ${e.now?'now':''}"><div class="et">${e.t}${e.now?' Â· NOW':''}</div><div class="es">${e.s}</div>${e.now?`<div class="ep"><div class="epf" style="width:${e.p}%"></div></div>`:''}</div>`).join('');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function togglePlay(){playing=!playing;document.getElementById('playBtn').textContent=playing?'â¸':'â–¶';toast(playing?'â–¶ Resumed':'â¸ Paused',curCh.name);}
function scrub(e,el){const r=el.getBoundingClientRect();document.getElementById('pfill').style.width=Math.max(0,Math.min(100,(e.clientX-r.left)/r.width*100))+'%';}
function setVol(e,el){const r=el.getBoundingClientRect();const v=Math.round(Math.max(0,Math.min(100,(e.clientX-r.left)/r.width*100)));document.getElementById('vf').style.width=v+'%';toast('ğŸ”Š Volume',v+'%');}
function updateClock(){const n=new Date();document.getElementById('osdClk').textContent=String(n.getHours()).padStart(2,'0')+':'+String(n.getMinutes()).padStart(2,'0');}
setInterval(updateClock,1000);updateClock();
setInterval(()=>{if(playing){progress=Math.min(100,progress+.05);document.getElementById('pfill').style.width=progress+'%';}},1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  OVERLAYS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(){document.getElementById('settingsOv').classList.add('open');}
function closeSettings(){document.getElementById('settingsOv').classList.remove('open');}
function openPlaylist(){document.getElementById('plOv').classList.add('open');renderSaved();}
function closePl(){document.getElementById('plOv').classList.remove('open');}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PLAYLIST MODAL LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let curM='m3u',m3uMode='url';

function selM(m){
  curM=m;
  ['m3u','xtream','stalker','mac'].forEach(x=>{
    document.getElementById('mc-'+x).classList.toggle('sel',x===m);
    document.getElementById('form-'+x).style.display=x===m?'flex':'none';
    if(x===m){const f=document.getElementById('form-'+x);f.style.flexDirection='column';f.style.gap='13px';}
  });
  clearStatuses();
}

function m3uTab(t){
  m3uMode=t;
  document.getElementById('m3u-url-body').style.display=t==='url'?'flex':'none';
  if(t==='url') document.getElementById('m3u-url-body').style.flexDirection='column';
  if(t==='url') document.getElementById('m3u-url-body').style.gap='6px';
  document.getElementById('m3u-file-body').style.display=t==='file'?'flex':'none';
  if(t==='file'){const f=document.getElementById('m3u-file-body');f.style.flexDirection='column';f.style.gap='8px';}
  document.getElementById('st-url').classList.toggle('on',t==='url');
  document.getElementById('st-file').classList.toggle('on',t==='file');
}

// â”€â”€â”€ M3U â”€â”€â”€
function addM3U(){
  const name=g('m3u-name');
  if(!name){err('m3u-name','m3u-st','Please enter a playlist name.');return;}
  if(m3uMode==='url'){
    const url=g('m3u-url');
    if(!url){err('m3u-url','m3u-st','Please enter an M3U URL.');return;}
    if(!url.startsWith('http')){err('m3u-url','m3u-st','URL must start with http:// or https://');return;}
    setSt('m3u-st','load','â³ Fetching and parsing playlist...');
    setTimeout(()=>{
      const pl={id:Date.now(),type:'M3U URL',ico:'ğŸ”—',name,url,refresh:g('m3u-ref'),added:td(),channels:rnd()};
      savePl(pl);clr('m3u-name');clr('m3u-url');setSt('m3u-st','','');
      toast('âœ… Added!',`${pl.name} â€” ${pl.channels} channels`,'ok');closePl();
    },1300);
  } else {
    if(!selFile){toast('âŒ No file','Select an M3U file first','err');return;}
    const reader=new FileReader();
    reader.onload=e=>{
      const txt=e.target.result;
      const cnt=txt.split('\n').filter(l=>l.includes('#EXTINF')).length||txt.split('\n').filter(l=>l.trim().startsWith('http')).length;
      const pl={id:Date.now(),type:'M3U File',ico:'ğŸ“',name,file:selFile.name,added:td(),channels:cnt||rnd()};
      savePl(pl);clearFile();clr('m3u-name');
      toast('âœ… Added!',`${pl.name} â€” ${pl.channels} channels`,'ok');closePl();
    };
    reader.readAsText(selFile);
  }
}

// â”€â”€â”€ XTREAM â”€â”€â”€
function testXtream(){
  const host=g('xt-host'),user=g('xt-user'),pass=g('xt-pass');
  if(!host||!user||!pass){setSt('xt-st','err','âŒ Fill in all fields.');return;}
  if(!host.startsWith('http')){setSt('xt-st','err','âŒ Server URL must start with http://');return;}
  setSt('xt-st','load','ğŸ”„ Connecting to Xtream serverâ€¦');
  // Production: fetch(`${host}/player_api.php?username=${user}&password=${pass}`)
  setTimeout(()=>setSt('xt-st','ok',`âœ… Connected! ${rnd()} channels available.`),1600);
}
function addXtream(){
  const name=g('xt-name'),host=g('xt-host'),user=g('xt-user'),pass=g('xt-pass');
  if(!name){err('xt-name','xt-st','Enter a playlist name.');return;}
  if(!host){err('xt-host','xt-st','Enter the server URL.');return;}
  if(!user){err('xt-user','xt-st','Enter your username.');return;}
  if(!pass){err('xt-pass','xt-st','Enter your password.');return;}
  if(!host.startsWith('http')){err('xt-host','xt-st','Server URL must start with http://');return;}
  setSt('xt-st','load','ğŸ”„ Authenticating with Xtream APIâ€¦');
  setTimeout(()=>{
    const pl={id:Date.now(),type:'Xtream',ico:'âš¡',name,host,user,fmt:g('xt-fmt'),added:td(),channels:rnd()};
    savePl(pl);['xt-name','xt-host','xt-user','xt-pass'].forEach(clr);setSt('xt-st','','');
    toast('âœ… Added!',`${pl.name} â€” ${pl.channels} channels`,'ok');closePl();
  },1400);
}

// â”€â”€â”€ STALKER â”€â”€â”€
function testStalker(){
  const url=g('st-url2'),mac=g('st-mac');
  if(!url||!mac){setSt('st-st','err','âŒ Portal URL and MAC address are required.');return;}
  if(!validMAC(mac)){setSt('st-st','err','âŒ Invalid MAC. Format: 00:1A:79:XX:XX:XX');return;}
  if(!url.startsWith('http')){setSt('st-st','err','âŒ Portal URL must start with http://');return;}
  setSt('st-st','load','ğŸ”„ Contacting Stalker portalâ€¦');
  // Production: token handshake via portal URL + MAC
  setTimeout(()=>setSt('st-st','ok','âœ… Portal connected! Auth token received.'),1800);
}
function addStalker(){
  const name=g('st-name'),url=g('st-url2'),mac=g('st-mac');
  if(!name){err('st-name','st-st','Enter a playlist name.');return;}
  if(!url){err('st-url2','st-st','Enter the portal URL.');return;}
  if(!mac){err('st-mac','st-st','Enter your MAC address.');return;}
  if(!validMAC(mac)){err('st-mac','st-st','Invalid MAC. Format: 00:1A:79:XX:XX:XX');return;}
  if(!url.startsWith('http')){err('st-url2','st-st','Portal URL must start with http://');return;}
  setSt('st-st','load','ğŸ”„ Connecting to Stalker portalâ€¦');
  setTimeout(()=>{
    const pl={id:Date.now(),type:'Stalker',ico:'ğŸ“¡',name,url,mac,serial:g('st-serial'),added:td(),channels:rnd()};
    savePl(pl);['st-name','st-url2','st-mac','st-serial','st-devid'].forEach(clr);setSt('st-st','','');
    toast('âœ… Added!',`${pl.name} â€” ${pl.channels} channels`,'ok');closePl();
  },1600);
}

// â”€â”€â”€ MAC PORTAL â”€â”€â”€
function testMAC(){
  const url=g('mac-url'),mac=g('mac-mac');
  if(!url||!mac){setSt('mac-st','err','âŒ Portal URL and MAC address are required.');return;}
  if(!validMAC(mac)){setSt('mac-st','err','âŒ Invalid MAC. Format: 00:1A:79:XX:XX:XX');return;}
  if(!url.startsWith('http')){setSt('mac-st','err','âŒ Portal URL must start with http://');return;}
  setSt('mac-st','load','ğŸ”„ Authenticating MAC addressâ€¦');
  // Production: portal handshake
  setTimeout(()=>setSt('mac-st','ok','âœ… MAC authenticated! Portal access granted.'),1700);
}
function addMAC(){
  const name=g('mac-name'),url=g('mac-url'),mac=g('mac-mac');
  if(!name){err('mac-name','mac-st','Enter a playlist name.');return;}
  if(!url){err('mac-url','mac-st','Enter the portal URL.');return;}
  if(!mac){err('mac-mac','mac-st','Enter your MAC address.');return;}
  if(!validMAC(mac)){err('mac-mac','mac-st','Invalid MAC. Format: 00:1A:79:XX:XX:XX');return;}
  if(!url.startsWith('http')){err('mac-url','mac-st','Portal URL must start with http://');return;}
  setSt('mac-st','load','ğŸ”„ Connecting to MAC portalâ€¦');
  setTimeout(()=>{
    const pl={id:Date.now(),type:'MAC Portal',ico:'ğŸ–¥ï¸',name,url,mac,tz:g('mac-tz'),added:td(),channels:rnd()};
    savePl(pl);['mac-name','mac-url','mac-mac'].forEach(clr);setSt('mac-st','','');
    toast('âœ… Added!',`${pl.name} â€” ${pl.channels} channels`,'ok');closePl();
  },1500);
}

// â”€â”€â”€ FILE HANDLING â”€â”€â”€
function fileDrop(e){
  e.preventDefault();document.getElementById('dz').classList.remove('over');
  const f=e.dataTransfer.files[0];if(f)setFile(f);
}
function filePick(e){const f=e.target.files[0];if(f)setFile(f);}
function setFile(f){
  if(!f.name.match(/\.(m3u|m3u8|txt)$/i)){toast('âŒ Wrong type','Select a .m3u or .m3u8 file','err');return;}
  selFile=f;
  if(!document.getElementById('m3u-name').value)document.getElementById('m3u-name').value=f.name.replace(/\.(m3u8?|txt)$/i,'');
  document.getElementById('dz').style.display='none';
  document.getElementById('fchip').style.display='flex';
  document.getElementById('chipName').textContent='ğŸ“„ '+f.name+' ('+Math.round(f.size/1024)+' KB)';
}
function clearFile(){
  selFile=null;
  document.getElementById('dz').style.display='flex';
  document.getElementById('fchip').style.display='none';
  document.getElementById('fileInp').value='';
}

// â”€â”€â”€ SAVED PLAYLISTS â”€â”€â”€
function savePl(pl){
  playlists.push(pl);
  try{localStorage.setItem('sf_pl',JSON.stringify(playlists));}catch(e){}
  // Inject sample channels
  const emojis=['ğŸ“º','ğŸ¬','ğŸ“¡','ğŸŒ','ğŸ”´','ğŸ“»','ğŸ’«'];
  const clrs=['#00d4ff','#ff6b35','#22c55e','#f59e0b','#8b5cf6','#ec4899'];
  const cats=['sports','news','movies','kids','docs'];
  for(let i=0;i<Math.min(6,pl.channels);i++){
    channels.push({id:Date.now()+i+Math.random(),name:`${pl.name} Ch ${i+1}`,prog:'Live Stream',q:['HD','4K','SD'][i%3],cat:cats[i%5],ico:emojis[i%7],clr:clrs[i%6]});
  }
  renderChs(channels.filter(c=>curCat==='all'||c.cat===curCat));
  renderSaved();
}
function renderSaved(){
  const sec=document.getElementById('savedSec');
  const list=document.getElementById('savedList');
  if(!playlists.length){sec.style.display='none';return;}
  sec.style.display='block';
  list.innerHTML=playlists.map(pl=>`
    <div class="si">
      <div class="si-ico">${pl.ico||'ğŸ“‹'}</div>
      <div class="si-info"><div class="si-name">${pl.name}</div><div class="si-meta">${pl.channels} channels Â· ${pl.added}</div></div>
      <span class="si-badge">${pl.type}</span>
      <div class="si-acts">
        <button class="sia" onclick="refreshPl(${pl.id})">ğŸ”„</button>
        <button class="sia del" onclick="delPl(${pl.id})">ğŸ—‘</button>
      </div>
    </div>`).join('');
}
function delPl(id){
  playlists=playlists.filter(p=>p.id!==id);
  try{localStorage.setItem('sf_pl',JSON.stringify(playlists));}catch(e){}
  renderSaved();toast('ğŸ—‘ Removed','Playlist deleted');
}
function refreshPl(id){const pl=playlists.find(p=>p.id===id);setSt((curM+'-st'),'load','ğŸ”„ Refreshingâ€¦');setTimeout(()=>setSt((curM+'-st'),'ok','âœ… Refreshed!'),1200);toast('ğŸ”„ Refreshing',pl?pl.name:'Playlist');}

// â”€â”€â”€ HELPERS â”€â”€â”€
function g(id){return document.getElementById(id)?document.getElementById(id).value.trim():'';}
function clr(id){const el=document.getElementById(id);if(el)el.value='';}
function td(){return new Date().toLocaleDateString();}
function rnd(){return Math.floor(Math.random()*1500)+200;}
function validMAC(m){return /^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/.test(m);}
function fmtMAC(el){let v=el.value.replace(/[^0-9A-Fa-f]/g,''),o='';for(let i=0;i<v.length&&i<12;i++){if(i>0&&i%2===0)o+=':';o+=v[i];}el.value=o.toUpperCase();}
function setSt(id,type,msg){const el=document.getElementById(id);if(!el)return;el.className='status'+(type?' '+type:'');el.textContent=msg;if(!type||!msg)el.style.display='none';}
function err(inpId,stId,msg){
  const el=document.getElementById(inpId);
  if(el){el.classList.add('err');setTimeout(()=>el.classList.remove('err'),2000);}
  setSt(stId,'err','âŒ '+msg);toast('âŒ Error',msg,'err');
}
function clearStatuses(){['m3u-st','xt-st','st-st','mac-st'].forEach(id=>setSt(id,'',''));}

// â”€â”€â”€ TOAST â”€â”€â”€
let tT;
function toast(title,msg,type=''){
  clearTimeout(tT);
  document.getElementById('tTitle').textContent=title;
  document.getElementById('tMsg').textContent=msg;
  const el=document.getElementById('toast');
  el.className='toast show'+(type?' t'+type:'');
  tT=setTimeout(()=>el.classList.remove('show'),2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
selM('m3u');
m3uTab('url');
renderChs(channels);
renderEPG();
renderSaved();
</script>
</body>
</html>
